Global
Viper

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.625ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[2.565ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:54
[1.725ms] [rows:-] SELECT count(*) FROM information_schema.tables WHERE table_schema = 'douyin' AND table_name = 'users' AND table_type = 'BASE TABLE'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.321ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.448ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:148
[3.914ms] [rows:-] SELECT * FROM `users` LIMIT 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:166
[1.898ms] [rows:-] SELECT column_name, column_default, is_nullable = 'YES', data_type, character_maximum_length, column_type, column_key, extra, column_comment, numeric_precision, numeric_scale , datetime_precision FROM information_schema.columns WHERE table_schema = 'douyin' AND table_name = 'users' ORDER BY ORDINAL_POSITION

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.125ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[1.807ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:55
[0.594ms] [rows:-] SELECT count(*) FROM information_schema.tables WHERE table_schema = 'douyin' AND table_name = 'videos' AND table_type = 'BASE TABLE'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[5.504ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[1.343ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:148
[2.712ms] [rows:-] SELECT * FROM `videos` LIMIT 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:166
[1.768ms] [rows:-] SELECT column_name, column_default, is_nullable = 'YES', data_type, character_maximum_length, column_type, column_key, extra, column_comment, numeric_precision, numeric_scale , datetime_precision FROM information_schema.columns WHERE table_schema = 'douyin' AND table_name = 'videos' ORDER BY ORDINAL_POSITION

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.076ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.398ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:55
[0.874ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'videos' AND index_name = 'idx_videos_author_id'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.221ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.321ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:55
[0.816ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'videos' AND index_name = 'idx_videos_created_at'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.064ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.331ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:56
[0.278ms] [rows:-] SELECT count(*) FROM information_schema.tables WHERE table_schema = 'douyin' AND table_name = 'favorites' AND table_type = 'BASE TABLE'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.055ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[1.366ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:148
[1.985ms] [rows:-] SELECT * FROM `favorites` LIMIT 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:166
[0.892ms] [rows:-] SELECT column_name, column_default, is_nullable = 'YES', data_type, character_maximum_length, column_type, column_key, extra, column_comment, numeric_precision, numeric_scale , datetime_precision FROM information_schema.columns WHERE table_schema = 'douyin' AND table_name = 'favorites' ORDER BY ORDINAL_POSITION

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.070ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[4.729ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:56
[0.223ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'favorites' AND index_name = 'idx_01'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.059ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.349ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:56
[0.760ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'favorites' AND index_name = 'idx_02'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.061ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.321ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:57
[0.171ms] [rows:-] SELECT count(*) FROM information_schema.tables WHERE table_schema = 'douyin' AND table_name = 'comments' AND table_type = 'BASE TABLE'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.053ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.299ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:148
[0.894ms] [rows:-] SELECT * FROM `comments` LIMIT 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:166
[2.313ms] [rows:-] SELECT column_name, column_default, is_nullable = 'YES', data_type, character_maximum_length, column_type, column_key, extra, column_comment, numeric_precision, numeric_scale , datetime_precision FROM information_schema.columns WHERE table_schema = 'douyin' AND table_name = 'comments' ORDER BY ORDINAL_POSITION

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.076ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[1.349ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:57
[0.378ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'comments' AND index_name = 'video_user'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.067ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.342ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:58
[0.280ms] [rows:-] SELECT count(*) FROM information_schema.tables WHERE table_schema = 'douyin' AND table_name = 'follows' AND table_type = 'BASE TABLE'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.059ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.312ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:148
[0.567ms] [rows:-] SELECT * FROM `follows` LIMIT 1

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:166
[2.816ms] [rows:-] SELECT column_name, column_default, is_nullable = 'YES', data_type, character_maximum_length, column_type, column_key, extra, column_comment, numeric_precision, numeric_scale , datetime_precision FROM information_schema.columns WHERE table_schema = 'douyin' AND table_name = 'follows' ORDER BY ORDINAL_POSITION

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.119ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.537ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:58
[0.612ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'follows' AND index_name = 'idx_01'

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:228
[0.096ms] [rows:-] SELECT DATABASE()

2022/10/29 13:55:11 /data/go/pkg/mod/gorm.io/driver/mysql@v1.3.3/migrator.go:231
[0.428ms] [rows:1] SELECT SCHEMA_NAME from Information_schema.SCHEMATA where SCHEMA_NAME LIKE 'douyin%' ORDER BY SCHEMA_NAME='douyin' DESC limit 1

2022/10/29 13:55:11 /home/cheng/Desktop/Linux/douyin-fighting/initialize/mysql.go:58
[0.304ms] [rows:-] SELECT count(*) FROM information_schema.statistics WHERE table_schema = 'douyin' AND table_name = 'follows' AND index_name = 'idx_02'
MySQL
Redis
1111111111111111111
0.0.0.0:8080[GIN] 2022/10/29 - 13:55:14 | 200 |      969.52µs |    192.168.77.1 | GET      "/douyin/favorite/list/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIzNDUyNDk4NDI5NzU4ODQ5LCJOYW1lIjoiMSIsImV4cCI6MTY2NzE2MjM3NSwibmJmIjoxNjY3MDc1OTc1LCJpYXQiOjE2NjcwNzU5NzV9.F2evzEjkR8YpG9M2aZ58rhUZUgQCs35gx7ZE4XRjBX8&user_id=23452498429758849"

2022/10/29 13:55:14 /home/cheng/Desktop/Linux/douyin-fighting/service/video.go:243
[1.219ms] [rows:7] SELECT * FROM `videos` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457)

2022/10/29 13:55:14 /home/cheng/Desktop/Linux/douyin-fighting/service/comment.go:209
[0.553ms] [rows:0] SELECT `video_id`,COUNT(video_id) as comment_count FROM `comments` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457) AND `comments`.`deleted_at` IS NULL GROUP BY `video_id`

2022/10/29 13:55:14 /home/cheng/Desktop/Linux/douyin-fighting/service/favorite.go:178
[0.435ms] [rows:0] SELECT `video_id`,COUNT(video_id) as favorite_count FROM `favorites` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457) and is_favorite = true GROUP BY `video_id`
[GIN] 2022/10/29 - 13:55:14 | 500 |    3.868905ms |    192.168.77.1 | GET      "/douyin/publish/list/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIzNDUyNDk4NDI5NzU4ODQ5LCJOYW1lIjoiMSIsImV4cCI6MTY2NzE2MjM3NSwibmJmIjoxNjY3MDc1OTc1LCJpYXQiOjE2NjcwNzU5NzV9.F2evzEjkR8YpG9M2aZ58rhUZUgQCs35gx7ZE4XRjBX8&user_id=23452498429758849"

2022/10/29 13:55:19 /home/cheng/Desktop/Linux/douyin-fighting/service/video.go:243
[0.339ms] [rows:5] SELECT * FROM `videos` WHERE video_id in (23464019025218945,23462739410177409,23462573751946625,23461385153301889,23245963636264321)

2022/10/29 13:55:19 /home/cheng/Desktop/Linux/douyin-fighting/service/comment.go:209
[0.572ms] [rows:0] SELECT `video_id`,COUNT(video_id) as comment_count FROM `comments` WHERE video_id in (23464019025218945,23462739410177409,23462573751946625,23461385153301889,23245963636264321) AND `comments`.`deleted_at` IS NULL GROUP BY `video_id`

2022/10/29 13:55:19 /home/cheng/Desktop/Linux/douyin-fighting/service/favorite.go:178
[0.216ms] [rows:0] SELECT `video_id`,COUNT(video_id) as favorite_count FROM `favorites` WHERE video_id in (23464019025218945,23462739410177409,23462573751946625,23461385153301889,23245963636264321) and is_favorite = true GROUP BY `video_id`
[GIN] 2022/10/29 - 13:55:19 | 500 |    1.872214ms |    192.168.77.1 | GET      "/douyin/feed/?latest_time=1667076920051&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIzNDUyNDk4NDI5NzU4ODQ5LCJOYW1lIjoiMSIsImV4cCI6MTY2NzE2MjM3NSwibmJmIjoxNjY3MDc1OTc1LCJpYXQiOjE2NjcwNzU5NzV9.F2evzEjkR8YpG9M2aZ58rhUZUgQCs35gx7ZE4XRjBX8"

2022/10/29 13:55:21 /home/cheng/Desktop/Linux/douyin-fighting/service/video.go:243
[0.928ms] [rows:7] SELECT * FROM `videos` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457)
[GIN] 2022/10/29 - 13:55:21 | 200 |     877.086µs |    192.168.77.1 | GET      "/douyin/favorite/list/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIzNDUyNDk4NDI5NzU4ODQ5LCJOYW1lIjoiMSIsImV4cCI6MTY2NzE2MjM3NSwibmJmIjoxNjY3MDc1OTc1LCJpYXQiOjE2NjcwNzU5NzV9.F2evzEjkR8YpG9M2aZ58rhUZUgQCs35gx7ZE4XRjBX8&user_id=23452498429758849"

2022/10/29 13:55:21 /home/cheng/Desktop/Linux/douyin-fighting/service/comment.go:209
[0.627ms] [rows:0] SELECT `video_id`,COUNT(video_id) as comment_count FROM `comments` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457) AND `comments`.`deleted_at` IS NULL GROUP BY `video_id`

2022/10/29 13:55:21 /home/cheng/Desktop/Linux/douyin-fighting/service/favorite.go:178
[0.708ms] [rows:0] SELECT `video_id`,COUNT(video_id) as favorite_count FROM `favorites` WHERE video_id in (23453787305823617,23453727427939713,23453554370956673,23453395339726209,23452935241354625,23452930409516417,23452612732931457) and is_favorite = true GROUP BY `video_id`
[GIN] 2022/10/29 - 13:55:21 | 500 |    4.500109ms |    192.168.77.1 | GET      "/douyin/publish/list/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjIzNDUyNDk4NDI5NzU4ODQ5LCJOYW1lIjoiMSIsImV4cCI6MTY2NzE2MjM3NSwibmJmIjoxNjY3MDc1OTc1LCJpYXQiOjE2NjcwNzU5NzV9.F2evzEjkR8YpG9M2aZ58rhUZUgQCs35gx7ZE4XRjBX8&user_id=23452498429758849"
publish 1111111111111111111
publish 2222222222222
publish 3333333333333
insert db

2022/10/29 13:55:28 /home/cheng/Desktop/Linux/douyin-fighting/service/video.go:70
[4.593ms] [rows:1] INSERT INTO `videos` (`title`,`play_name`,`cover_name`,`author_id`,`created_at`,`ext_info`,`video_id`) VALUES ('a','23464157454028161','23464157454028161.jpg',0,'2022-10-29 13:55:28.826',NULL,23464157454028161)
redis
redis 1
redis 4
pipe 
pipe 1
pipe 2
pipe 3
pipe 4
cannot written to db
EXECABORT Transaction discarded because of previous errors.
[GIN] 2022/10/29 - 13:55:28 | 500 |  135.923565ms |    192.168.77.1 | POST     "/douyin/publish/action/"
